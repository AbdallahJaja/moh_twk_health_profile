<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MOH Vitals Mini App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="twk_helper.js"></script>
    <script src="constants.js"></script>
    <script src="settings.js"></script>
  </head>
  <body>
    <div class="container my-3">
      <div class="d-flex align-items-center mb-3">
        <img id="user-image" src="" alt="User Image" class="rounded-circle" width="50" height="50" />
        <h4 id="greeting">Hi, Abdullah Jaja</h4>
      </div>
      <div id="loading" class="shimmer-wrapper">
        <div class="shimmer"></div>
      </div>
      <div id="vitals-list" class="list-group"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const vitalsListEl = document.getElementById("vitals-list");
        const loadingEl = document.getElementById("loading");

        async function loadVitals() {
          loadingEl.style.display = "block";
          try {
            const response = await fetch("mock_vitals.json");
            const data = await response.json();
            document.getElementById("user-image").src = data.user.image;
            document.getElementById("greeting").textContent = `${AppSettings.language === "ar" ? LANG_AR.greeting : LANG_EN.greeting}, ${data.user.name}`;
            renderVitals(data.vitals);
          } catch (error) {
            console.error("Error loading vitals", error);
          } finally {
            loadingEl.style.display = "none";
          }
        }

        function renderVitals(vitals) {
          vitalsListEl.innerHTML = "";
          vitals.forEach((vital) => {
            const vitalName = VITALS_TRANSLATION[vital.vital_key]?.[AppSettings.language] || vital.vital_key;
            const item = document.createElement("div");
            item.className = "list-group-item d-flex justify-content-between align-items-center";

            const vitalText = document.createElement("span");
            vitalText.textContent = `${vitalName}: ${vital.value} ${vital.unit || ""}`;

            const buttonsDiv = document.createElement("div");

            const infoBtn = document.createElement("button");
            infoBtn.className = "btn btn-info btn-sm mx-1";
            infoBtn.textContent = "i";
            infoBtn.onclick = () => alert(`${vitalName}: ${vital.value} ${vital.unit || ""}`);

            const editBtn = document.createElement("button");
            editBtn.className = "btn btn-primary btn-sm mx-1";
            editBtn.textContent = AppSettings.language === "ar" ? "تحرير" : "Edit";
            editBtn.onclick = () => alert(`Edit ${vitalName}`);

            const copyBtn = document.createElement("button");
            copyBtn.className = "btn btn-secondary btn-sm";
            copyBtn.textContent = AppSettings.language === "ar" ? "نسخ" : "Copy";
            copyBtn.onclick = () => navigator.clipboard.writeText(`${vitalName}: ${vital.value} ${vital.unit || ""}`);

            buttonsDiv.append(infoBtn, editBtn, copyBtn);
            item.append(vitalText, buttonsDiv);
            vitalsListEl.appendChild(item);
          });
        }

        loadVitals();
      });
    </script>
  </body>
</html>
